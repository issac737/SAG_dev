# 搜索模块提示词模板（中文）

event_filter:
  description: 使用LLM智能过滤匹配的事项
  variables:
    - events_list
    - query
    - background
    - event_count
    - threshold
  template: |
    你是专业的信息检索助手。根据用户的搜索目标，从以下事项列表中筛选匹配的事项。
    {background}
    ## 搜索目标
    {query}

    ## 候选事项列表（共{event_count}条）

    {events_list}

    ## 筛选要求
    1. 仔细理解搜索目标的意图
    2. 评估每个事项与搜索目标的相关性
    3. 只选择高相关性的事项（相关性阈值：{threshold}）
    4. 返回匹配事项的索引列表（如 [0, 3, 5]）
    5. 如果没有事项匹配，返回空列表 []

    ## 输出格式
    请严格按JSON格式返回结果，包含以下字段：
    - matched_indices: 匹配事项的索引列表
    - reasoning: 简要说明筛选理由（可选）

rewrite_and_extract_entities:
  description: 查询改写 + 焦点类型识别 + 实体识别（含背景实体筛选泛化）
  variables:
    - query
    - current_time
    - candidates
    - background_entities
    - entity_types
    - max_entities
  template: |
    你是搜索分析专家。分析用户的问题，确定如何搜索文档来回答它。

    ## 用户问题
    {query}

    ## 当前时间
    {current_time}

    ## 你的任务

    我们有一个文档数据库。你需要识别关键词来搜索相关文档。
    
    输出以下内容：

    **1. rewritten_query** - 改写问题
    使其清晰正式。如果已经清晰，保持原样。

    **2. entities** - 搜索关键词（核心任务）
    这些词将直接用于搜索数据库。每个关键词都是一个搜索入口点。
    
    **必须同时输出以下两类关键词：**
    
    A. **筛选**：从"背景实体"中选择与问题高度相关的，**保留原名**
       - 这些实体已被验证与相关文档关联，必须优先选择
       - 例如：背景中有"睡眠质量"且与问题相关，则输出"睡眠质量"
    
    B. **泛化**：对筛选出的实体进行改写/泛化，生成更多搜索入口
       - 例如："睡眠质量" → 泛化为"睡眠"、"睡眠健康"
       - 例如："身体健康" → 泛化为"健康"、"身体"
    
    C. **补充**：从问题中提取背景实体未覆盖的关键词
       - 问题中的专有名词（人名、地名、作品名等）
       - 问题的核心关键词
    
    **输出要求：筛选的原实体 + 泛化的实体 + 补充的关键词，一起放入 entities 数组。**

    **3. focus_entity_types** - 搜索维度（线索）
    应该从哪些类型的实体中搜索？这是通往答案的路径。范围要广。
    
    **4. target_entity_types** - 目标维度
    哪种类型的实体最可能包含答案？用于结果排序。

    ## 可用实体类型
    {entity_types}

    ## 背景实体（来自高质量相关事项，按重要性排序，优先筛选！）
    {background_entities}

    ## 候选实体（来自向量搜索，供参考）
    {candidates}

    ## 输出（JSON）
    ```json
    {{
      "rewritten_query": "...",
      "entities": ["...", "..."],
      "focus_entity_types": ["...", "..."],
      "target_entity_types": ["..."]
    }}
    ```
