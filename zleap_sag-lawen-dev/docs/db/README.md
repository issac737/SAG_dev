# æ•°æ®åº“è¿ç§»è„šæœ¬

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«**ä¸»ç³»ç»Ÿï¼ˆzleap_testï¼‰**æ•°æ®åº“çš„è¿ç§»è„šæœ¬ï¼Œç”¨äºä¸ **MVP (dataflow)** ä¿æŒå…¼å®¹ã€‚

- **ä¸»ç³»ç»Ÿ**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„å®Œæ•´æ•°æ®åº“ï¼ˆåŒ…å«å†å²æ•°æ®å’Œå†—ä½™å­—æ®µï¼‰
- **MVP**: æœ¬é¡¹ç›®å¼€å‘çš„æ–°ç‰ˆæœ¬æ•°æ®åº“ï¼ˆç²¾ç®€ã€ä¼˜åŒ–çš„è¡¨ç»“æ„ï¼‰

## ğŸ¯ è¿ç§»ç›®æ ‡

å®ç°ä¸»ç³»ç»Ÿå’Œ MVP çš„**åŒå‘å…¼å®¹**ï¼š

1. **MVP â†’ ä¸»ç³»ç»Ÿ**: ä¸»ç³»ç»Ÿæ·»åŠ  MVP æ–°æ¶æ„å­—æ®µï¼ˆå¦‚ `rank`, `chunk_id`ï¼‰
2. **ä¸»ç³»ç»Ÿ â†’ MVP**: MVP æ·»åŠ ä¸»ç³»ç»Ÿå¿…è¦å­—æ®µï¼ˆå¦‚ `conversation_id`, `type`ï¼‰

## ğŸ“Š è¿ç§»è¡¨æ¸…å•

### âœ… 1. source_event - æºäº‹ä»¶è¡¨

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **æ–‡ä»¶** | `migration_source_event.sql` |
| **çŠ¶æ€** | â³ å¾…æ‰§è¡Œ |
| **MVP æ”¹åŠ¨** | æ·»åŠ  `conversation_id`, `type`, `priority`, `status` å­—æ®µ |
| **ä¸»ç³»ç»Ÿæ”¹åŠ¨** | æ·»åŠ  `rank`, `chunk_id` å­—æ®µ |
| **å½±å“èŒƒå›´** | äº‹é¡¹æå–ã€æ˜¾ç¤ºã€æ’åºåŠŸèƒ½ |

### â³ 2. [å…¶ä»–è¡¨å¾…è¡¥å……]

## ğŸš€ æ‰§è¡Œæµç¨‹

### Step 1: å‡†å¤‡é˜¶æ®µ

```bash
# 1. å¤‡ä»½ä¸»ç³»ç»Ÿæ•°æ®åº“
mysqldump -u root -p zleap_test > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬
mysql -u root -p zleap_test_dev < migration_source_event.sql
```

### Step 2: MVP æ‰§è¡Œè¿ç§»

```bash
# åœ¨ MVP é¡¹ç›®ä¸­æ‰§è¡Œ Alembic è¿ç§»
cd /path/to/dataflow
alembic upgrade head
```

### Step 3: ä¸»ç³»ç»Ÿæ‰§è¡Œè¿ç§»

```bash
# æ‰§è¡Œ SQL è„šæœ¬
mysql -u root -p zleap_test < docs/db/migration_source_event.sql

# æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼ˆæ¨èï¼‰
mysql -u root -p zleap_test
source docs/db/migration_source_event.sql
```

### Step 4: éªŒè¯

```bash
# æ£€æŸ¥è¡¨ç»“æ„
mysql -u root -p zleap_test -e "DESCRIBE source_event;"

# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
mysql -u root -p zleap_test -e "SELECT COUNT(*) FROM source_event WHERE (article_id IS NULL AND conversation_id IS NULL);"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ‰§è¡Œå‰å¿…è¯»

1. **å¤‡ä»½æ•°æ®åº“** - å¿…é¡»å…ˆå¤‡ä»½ï¼Œé˜²æ­¢æ„å¤–
2. **æµ‹è¯•ç¯å¢ƒéªŒè¯** - å…ˆåœ¨æµ‹è¯•åº“æ‰§è¡Œï¼Œç¡®ä¿æ— è¯¯
3. **æ£€æŸ¥æ•°æ®å®Œæ•´æ€§** - éªŒè¯è„šæœ¬ä¸­çš„æ£€æŸ¥ SQL
4. **è®°å½•æ‰§è¡Œç»“æœ** - åœ¨è„šæœ¬åº•éƒ¨å¡«å†™æ‰§è¡Œè®°å½•
5. **é€šçŸ¥å›¢é˜Ÿ** - å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæå‰é€šçŸ¥

### å¸¸è§é—®é¢˜

**Q: çº¦æŸæ·»åŠ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
```sql
-- æ£€æŸ¥å“ªäº›æ•°æ®ä¸ç¬¦åˆçº¦æŸ
SELECT * FROM source_event 
WHERE article_id IS NULL AND conversation_id IS NULL;

-- æ¸…ç†æˆ–ä¿®å¤æ•°æ®åé‡è¯•
```

**Q: å­—æ®µå·²å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ**
- æ£€æŸ¥å­—æ®µå®šä¹‰æ˜¯å¦ä¸€è‡´
- å¦‚æœä¸€è‡´ï¼Œè·³è¿‡è¯¥æ­¥éª¤
- å¦‚æœä¸ä¸€è‡´ï¼Œéœ€è¦å…ˆä¿®æ”¹å­—æ®µç±»å‹

**Q: ç´¢å¼•åç§°å†²çªæ€ä¹ˆåŠï¼Ÿ**
```sql
-- æŸ¥çœ‹ç°æœ‰ç´¢å¼•
SHOW INDEX FROM source_event;

-- åˆ é™¤æ—§ç´¢å¼•ï¼ˆå¦‚æœéœ€è¦ï¼‰
DROP INDEX idx_rank ON source_event;
```

## ğŸ“ æ‰§è¡Œè®°å½•æ¨¡æ¿

```markdown
### source_event è¡¨è¿ç§»

- **æ‰§è¡Œæ—¶é—´**: 2025-11-13 16:00:00
- **æ‰§è¡Œäºº**: [å§“å]
- **æ‰§è¡Œç¯å¢ƒ**: zleap_test
- **å½±å“è¡Œæ•°**: 
  - rank å­—æ®µ: 1,234 è¡Œ
  - chunk_id å­—æ®µ: 1,234 è¡Œ
- **éªŒè¯ç»“æœ**: âœ… æˆåŠŸ
- **å¤‡æ³¨**: æ‰€æœ‰ç°æœ‰æ•°æ® rank é»˜è®¤ä¸º 0ï¼Œåç»­ä¼šé€šè¿‡åº”ç”¨å±‚æ›´æ–°
```

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

æ¯ä¸ªè¿ç§»è„šæœ¬éƒ½åŒ…å«å›æ»š SQLï¼ˆæ³¨é‡Šéƒ¨åˆ†ï¼‰ï¼Œå¦‚éœ€å›æ»šï¼š

```sql
-- å–æ¶ˆæ³¨é‡Šè„šæœ¬åº•éƒ¨çš„å›æ»šéƒ¨åˆ†å¹¶æ‰§è¡Œ
```

## ğŸ“ è”ç³»æ–¹å¼

é‡åˆ°é—®é¢˜è¯·è”ç³»ï¼š
- **å¼€å‘è´Ÿè´£äºº**: [ä½ çš„åå­—]
- **DBA**: [DBA åå­—]
- **ç´§æ€¥è”ç³»**: [ç”µè¯/ä¼å¾®]

